# í™˜ê²½ì„¸íŒ… ê°€ì´ë“œ



### 0. ì£¼ì˜

ğŸš«**ë°˜ë“œì‹œ backend ì„œë²„ êµ¬ë™ í›„ frontendë¥¼ ì‹¤í–‰ì‹œì¼œì•¼ í•œë‹¤.**ğŸš«

### 1. .env íŒŒì¼ ìƒì„±

1. S05P13B107/recom/.env  ìƒì„±

   ```bash
   NODE_ORIGIN = '<http://localhost:3000>'
   DJANGO_ORIGIN = '<http://localhost:8000>'
   ```

2. S05P13B107/backend/.env  ìƒì„±

   DB_PASSWORDì˜ password ì—ëŠ” dbê³„ì • ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•œë‹¤.

   ```bash
   DB_HOST = localhost
   DB_USERNAME = root
   DB_PASSWORD = password
   DB_DATABASE = chillingvibe
   JWT_SECRET_KEY = bvx5RC4g2041s5WD95WNbuM0KGnsjvRyummVEbemguNBfmpjyc
   ACCESS_TOKEN_SECRET = bvx5RC4g2041s5WD95WNbuM0KGnsjvRyummVEbemguNBfmpjyc
   REFRESH_TOKEN_SECRET = bvx5RC4g2041s5WD95WNbuM0KGnsjvRyummVEbemguNBfmpjyc
   ```

### 2. ë¼ì¦ˆë² ë¦¬íŒŒì´ ì—†ì´ ì›¹í˜ì´ì§€ë§Œ í™•ì¸í•  ê²½ìš°

1. ì¶”ì²œë¡œì§ (django) ì—°ê²°

   1. S05P13B107/recom ì´ë™

   2. ê°€ìƒí™˜ê²½ ìƒì„±

      ```bash
      python -m venv venv
      ```

   3. ê°€ìƒí™˜ê²½ ì§„ì…

      ```bash
      # window
      source venv/Scripts/activate
      # linux
      source venv/bin/activate
      ```

   4. migrate

      ```bash
      python manage.py migrate
      ```

   5. ì„œë²„ êµ¬ë™

      ```bash
      python manage.py runserver
      ```

2. backend (node) ì—°ê²°

   1. S05P13B107/backend ì´ë™

   2. module ì„¤ì¹˜

      ```bash
      npm install
      ```

   3. ì„œë²„ êµ¬ë™

      ```bash
      npm start
      ```

3. frontend (react) ì—°ê²°

   1. S05P13B107/frontend ì´ë™

   2. module ì„¤ì¹˜

      ```bash
      npm install
      ```

   3. ì„œë²„ êµ¬ë™

      ```bash
      npm start
      ```

   4. í•´ë‹¹ ë©”ì„¸ì§€ê°€ ë‚˜íƒ€ë‚˜ë©´ Y ì…ë ¥

      ```bash
      ? Something is already running on port 3000.
      
      Would you like to run the app on another port instead? Â» (Y/n)
      ```

### 3. ë¼ì¦ˆë² ë¦¬íŒŒì´ ê¸°ë°˜ìœ¼ë¡œ ì„¼ì„œë¥¼ ì—°ê²°í•  ê²½ìš°

1. ì¶”ì²œë¡œì§ (django) ì—°ê²°

   : 2ë²ˆê³¼ ë˜‘ê°™ì´ ì§„í–‰í•˜ë˜, pythonì„ ì „ë¶€ `python3` ìœ¼ë¡œ ë°”ê¾¸ì–´ ì…ë ¥í•œë‹¤.

2. backend (node) ì—°ê²°

   1. S05P13B107/backend/routes/iot.js íŒŒì¼ì˜ ì£¼ì„ì²˜ë¦¬ ëœ ì½”ë“œ ì¼ë¶€ë¥¼ ì£¼ì„ í•´ì œ(IoT ì „ìš© ì½”ë“œ), ì¼ë°˜ ì½”ë“œë¥¼ ì£¼ì„ì²˜ë¦¬í•œë‹¤ (í•˜ë‹¨ ì½”ë“œ ì°¸ê³ )

      ```bash
      var express = require('express');
      var router = express.Router();
      var onoff = require('onoff')
      var pigpio = require('pigpio');
      const db = require('../lib/db');
      const util = require('../utils/util')
      
      router.get('/led', util.isLogin, (req, res, next) =>{
          var Gpio = onoff.Gpio
          var power = new Gpio(21, 'out')
          db.query(SELECT * FROM users_and_ingredients 
                  WHERE user_id='${req.user_id}' 
                  AND DATEDIFF(expiration_date, CURDATE()) < 0,
                  (err, rows) => {
          if (err) next (err)
          else if (rows.length === 0) { console.log('empty')
              power.writeSync(0)} // ë¶ˆ ì•ˆë“¤ì–´ì˜´
          else { console.log('not empty');
              power.writeSync(1);} // ë¶ˆë“¤ì–´ì˜´
          res.send(rows)
          })
      })
      
      // // ë¶€ì € ì½”ë“œ -> ì‹œê°„ ë‹¤ ë˜ë©´ ë°±ìœ¼ë¡œ ìš”ì²­
      const beeper =  new pigpio.Gpio (18, {mode: pigpio.Gpio.OUTPUT});
      function shortBeep()
      {
          beeper.pwmFrequency(4000);
          let maxDutyCycle = beeper.getPwmRange();
          let dutyCycle = Math.trunc(0.5 * maxDutyCycle);
          beeper.pwmWrite(dutyCycle);
          setTimeout(function(){
              beeper.pwmWrite(0)
          }, 300)
      }
      
      // // ë¶€ì € ìš¸ë¦¬ëŠ” ì½”ë“œ 
      router.get('/buzzer', function(req, res) {
          shortBeep()
          setTimeout(shortBeep, 1000)
          setTimeout(shortBeep, 2000)
          res.send();
      });
      
      module.exports = router;
      ```

   2. S05P13B107/backend ë¡œ ì´ë™í•˜ì—¬ npm install onoff , npm install pigpio ë¡œ ëª¨ë“ˆì„ ì¶”ê°€ ì„¤ì •í•œë‹¤.

   3. ```  sudo node app.js ``` ë¡œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.

3. frontend (react) ì—°ê²°

   : ë™ì¼





## ë°ì´í„°ë² ì´ìŠ¤ì„¸íŒ… ê°€ì´ë“œ



### 0. ìŠ¤í‚¤ë§ˆ ìƒì„±

``` bash
CREATE SCHEMA IF NOT EXISTS `chillingvibe` DEFAULT CHARACTER SET utf8 ;
USE `chillingvibe` ;
```



### 1. í…Œì´ë¸” êµ¬ì¶•

1. recipe_infos í…Œì´ë¸”

   ``` bash
   --
   -- Table structure for table `recipe_infos`
   --
   
   DROP TABLE IF EXISTS `recipe_infos`;
   CREATE TABLE `recipe_infos` (
     `recipe_info_id` int(10) unsigned NOT NULL,
     `title` tinytext DEFAULT NULL,
     `view` int(11) NOT NULL DEFAULT 0,
     `recipe_info_image` text DEFAULT NULL,
     PRIMARY KEY (`recipe_info_id`),
     FULLTEXT KEY `ft_title` (`title`)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```

2. ingredients í…Œì´ë¸”

   ``` bash
   --
   -- Table structure for table `ingredients`
   --
   
   DROP TABLE IF EXISTS `ingredients`;
   CREATE TABLE `ingredients` (
     `ingredient_name` varchar(45) NOT NULL,
     PRIMARY KEY (`ingredient_name`)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```



3. users í…Œì´ë¸”

   ```bash
   --
   -- Table structure for table `users`
   --
   
   DROP TABLE IF EXISTS `users`;
   CREATE TABLE `users` (
     `user_id` varchar(20) NOT NULL,
     `password` text NOT NULL,
     `email` varchar(45) NOT NULL,
     `salt` text NOT NULL,
     PRIMARY KEY (`user_id`),
     UNIQUE KEY `email` (`email`)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```

   

4. ingredients_and_recipe_infos í…Œì´ë¸”

   ``` bash
   --
   -- Table structure for table `ingredients_and_recipe_infos`
   --
   
   DROP TABLE IF EXISTS `ingredients_and_recipe_infos`;
   CREATE TABLE `ingredients_and_recipe_infos` (
     `recipe_info_id` int(10) unsigned NOT NULL,
     `ingredient_name` varchar(45) NOT NULL,
     `ingredient_amount` tinytext DEFAULT NULL,
     `source_flag` tinyint(1) NOT NULL DEFAULT 0,
     KEY `fk_ingredients_and_recipe_infos_ingredients_ingredient_name_idx` (`ingredient_name`),
     KEY `fk_ingredients_and_recipe_infos_recipe_infos_recipe_info_id` (`recipe_info_id`),
     FULLTEXT KEY `ft_ingredient_name` (`ingredient_name`),
     CONSTRAINT `fk_ingredients_and_recipe_infos_ingredients_ingredient_name` FOREIGN KEY (`ingredient_name`) REFERENCES `ingredients` (`ingredient_name`) ON DELETE NO ACTION ON UPDATE NO ACTION,
     CONSTRAINT `fk_ingredients_and_recipe_infos_recipe_infos_recipe_info_id` FOREIGN KEY (`recipe_info_id`) REFERENCES `recipe_infos` (`recipe_info_id`) ON DELETE NO ACTION ON UPDATE NO ACTION
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```

   

5. recipe_steps í…Œì´ë¸”

   ``` bash
   --
   -- Table structure for table `recipe_steps`
   --
   
   DROP TABLE IF EXISTS `recipe_steps`;
   CREATE TABLE `recipe_steps` (
     `recipe_info_id` int(10) unsigned NOT NULL,
     `step_order` int(10) unsigned NOT NULL,
     `step_comment` text NOT NULL,
     `image_source` text DEFAULT NULL,
     KEY `fk_recipe_steps_recipe_infos_recipe_info_id` (`recipe_info_id`),
     CONSTRAINT `fk_recipe_steps_recipe_infos_recipe_info_id` FOREIGN KEY (`recipe_info_id`) REFERENCES `recipe_infos` (`recipe_info_id`) ON DELETE NO ACTION ON UPDATE NO ACTION
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```

   

6. likes í…Œì´ë¸”

   ``` bash
   --
   -- Table structure for table `likes`
   --
   
   DROP TABLE IF EXISTS `likes`;
   CREATE TABLE `likes` (
     `user_id` varchar(20) NOT NULL,
     `recipe_info_id` int(10) unsigned NOT NULL,
     KEY `fk_likes_users_user_id_idx` (`user_id`),
     KEY `fk_likes_recipe_info_recipie_info_id_idx` (`recipe_info_id`),
     CONSTRAINT `fk_likes_recipe_info_recipie_info_id` FOREIGN KEY (`recipe_info_id`) REFERENCES `recipe_infos` (`recipe_info_id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
     CONSTRAINT `fk_likes_users_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```

7. users_and_ingredients í…Œì´ë¸”

   ``` bash
   --
   -- Table structure for table `users_and_ingredients`
   --
   
   DROP TABLE IF EXISTS `users_and_ingredients
   CREATE TABLE `users_and_ingredients` (
     `user_id` varchar(20) NOT NULL,
     `ingredient_name` varchar(45) NOT NULL,
     `expiration_date` date NOT NULL,
     KEY `fk_user_id_idx` (`user_id`),
     KEY `fk_users_and_ingredients_ingredients_ingredient_name_idx` (`ingredient_name`),
     CONSTRAINT `fk_users_and_ingredients_ingredients_ingredient_name` FOREIGN KEY (`ingredient_name`) REFERENCES `ingredients` (`ingredient_name`) ON DELETE NO ACTION ON UPDATE NO ACTION,
     CONSTRAINT `fk_users_and_ingredients_users_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`) ON DELETE NO ACTION ON UPDATE NO ACTION
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```

   

8. ingredients_preprocessing í…Œì´ë¸”

   ``` bash
   --
   -- Table structure for table `ingredients_preprocessing`
   --
   
   DROP TABLE IF EXISTS `ingredients_preprocessing`;
   CREATE TABLE `ingredients_preprocessing` (
     `ingredient_name` varchar(45) NOT NULL,
     `original` varchar(45) NOT NULL,
     KEY `fk_ingredients_preprocessiong_and_ingredients` (`ingredient_name`),
     FULLTEXT KEY `ft_original_name` (`original`),
     CONSTRAINT `fk_ingredients_preprocessiong_and_ingredients` FOREIGN KEY (`ingredient_name`) REFERENCES `ingredients` (`ingredient_name`) ON DELETE NO ACTION ON UPDATE NO ACTION
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
   ```

   



### 2. ê° í…Œì´ë¸” ë°ì´í„° import

#### ì£¼ì˜ ğŸš« ì™¸ë˜í‚¤ê°€ ì¡´ì¬í•˜ë¯€ë¡œ ìˆœì„œì— ë§ê²Œ í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì…ë ¥í•´ì•¼í•©ë‹ˆë‹¤ğŸš«

##### import ìˆœì„œ (ê´„í˜¸ì•ˆì˜ json íŒŒì¼ì„ ì´ìš©í•˜ì—¬ import í•©ë‹ˆë‹¤)

-- í…Œì´ë¸”ëª… (jsoníŒŒì¼ëª…)

1. ingredients (ingredients.json)
2. recipe_infos (recipe_infos_500.json)
3. recipe_steps (recipe_steps_500.json)
4. ingredients_and_recipe_infos (ingredients_and_recipe_infos.json)
5. ingredients_preprocessing (ingredients_preprocessing.json)



##### import ë°©ë²•

1. workbenchì—ì„œ importí•  í…Œì´ë¸” ìš°í´ë¦­
2. Table Data Import Wizard í´ë¦­
3. import í•  json íŒŒì¼ ì„ íƒ í›„ next
4. 'Use existing table' ì²´í¬ í›„ next
5. ê° ì—´ì— í•´ë‹¹í•˜ëŠ” ì´ë¦„ì´ ê°™ì€ì§€ ì²´í¬ í›„ next
6. Import Data í™”ë©´ì—ì„œ next í´ë¦­ ì‹œ import ì‹œì‘
7. importê°€ ì¢…ë£Œë˜ë©´ finish



